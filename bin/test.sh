#!/usr/bin/env bash

set -e

CHECK_IT='\xE2\x9C\x85'
ROOT=$(git rev-parse --show-toplevel)

# list of the node.js app modules
NPM_MODULES=( server static wss )

echo
echo -e "______ _           ___  ___               _           _ "
echo -e "|  ___(_)          |  \/  |              | |         | |"
echo -e "| |_   _ _ __ ___  | .  . | __ _ _ __ ___| |__   __ _| |"
echo -e "|  _| | | '__/ _ \ | |\/| |/ _\` | '__/ __| '_ \ / _\` | |"
echo -e "| |   | | | |  __/ | |  | | (_| | |  \__ \ | | | (_| | |"
echo -e "\_|   |_|_|  \___| \_|  |_/\__,_|_|  |___/_| |_|\__,_|_|"
echo

echo "lint & test all modules"

# generated by http://patorjk.com/software/taag/#p=testall&f=Fun%20Face&t=Fire%20Marshal

for i in "${NPM_MODULES[@]}"
do
    echo -e "$CHECK_IT  linting '${i}'"
    (cd ${ROOT}/${i} && npm run lint -- --fix)
done

echo -e "$CHECK_IT  testing 'static'"

(cd ${ROOT}/static && npm test)

echo -e "$CHECK_IT  done"
